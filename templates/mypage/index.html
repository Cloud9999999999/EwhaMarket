<!--마이페이지 첫 화면-->
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ewha Market</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/global.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/mypage.css') }}"
    />
  </head>
  <body>
    <header>
      <div class="logo">
        <a href="{{ url_for('home') }}">
          <img
            src="{{ url_for('static', filename='image/Market-logo.png') }}"
            alt="Ewha Market"
            class="logo"
          />
        </a>
      </div>
      <nav>
        <ul class="nav-menu">
          <li><a href="{{ url_for('home') }}">상품 조회</a></li>
          <li><a href="{{ url_for('reviews_index') }}">리뷰 조회</a></li>
          <li><a href="{{ url_for('reviews_write') }}">리뷰 등록</a></li>
          <li><a href="{{ url_for('products_enroll') }}">상품 등록</a></li>
          {% if session['id'] %}
          <li>
            <a href="{{ url_for('mypage_index') }}"
              ><b>{{ session['id'] }}님 반갑습니다!</b></a
            >
          </li>
          <li>
            <a href="/logout"> 로그아웃 </a>
          </li>
          {% else %}
          <li>
            <a href="{{ url_for('login') }}">회원가입/로그인</a>
          </li>
          {% endif %}
        </ul>
      </nav>
    </header>

    <section id="container">
      <div class="mypage-container">
        <h2 class="mypage-font">My Page</h2>

        <!--프로필-->
        <div class="content-container">
          <div
            style="
              display: flex;
              flex-direction: row;
              align-items: center;
              gap: 2rem;
            "
          >
            <img
              src="{{ url_for('static', filename='image/icon/profile-img.svg') }}"
              alt="프로필 이미지"
              class="profile-img"
            />
            <div>
              <div style="display: flex; flex-direction: row; gap: 12px">
                <div class="name-container">
                  <p>{{ user.username }}</p>
                  <!--username으로 바꿈-->
                </div>
                <form action="{{ url_for('mypage_edit') }}" method="get">
                  <button class="edit-button" id="edit-button" type="submit">
                    프로필 수정하기
                  </button>
                </form>
              </div>
              <p class="write-date" style="margin-top: 8px">
                {{ user.email }}
                <!--email로 바꿈-->
              </p>
            </div>
          </div>
        </div>

        <!--참여도 레벨-->
        <div class="content-container">
          <div class="container-header" style="justify-content: space-between">
            <p class="content-font">참여도 레벨</p>
            <p style="color: #34a853; font-size: 18px; font-weight: 600">
              Level 3 • 120pts
            </p>
          </div>
          <input
            type="range"
            min="0"
            max="200"
            value="120"
            step="10"
            class="level-bar"
          />
          <p style="color: #666666; font-size: 14px; margin-top: 12px">
            다음 레벨까지 80pts 남았어요
          </p>
        </div>

        <!--찜 목록 보기-->
        <div class="content-container2">
          <div class="container-header">
            <img
              src="{{ url_for('static', filename='image/icon/heart-fill.svg') }}"
              alt="하트 아이콘"
              class="content-icon"
            />
            <p class="content-font">찜 목록 보기</p>
            <p class="num-font">(4)</p>
          </div>
          <div
            style="
              display: flex;
              flex-direction: row;
              flex-wrap: wrap;
              justify-content: space-between;
            "
          >
            <div class="heart-container">
              <img src="../assets/heart-img2.png" alt="블루 틴트 안경" />
              <p class="write-head">블루 틴트 안경</p>
              <p class="price-write">25,000원</p>
            </div>
            <div class="heart-container">
              <img src="../assets/heart-img1.png" alt="블루 틴트 안경" />
              <p class="write-head">화장품 세트</p>
              <p class="price-write">15,000원</p>
            </div>
            <div class="heart-container">
              <img src="../assets/heart-img4.png" alt="블루 틴트 안경" />
              <p class="write-head">다이어리</p>
              <p class="price-write">8,000원</p>
            </div>
            <div class="heart-container">
              <img src="../assets/heart-img3.png" alt="블루 틴트 안경" />
              <p class="write-head">실버 귀걸이</p>
              <p class="price-write">12,000원</p>
            </div>
          </div>
        </div>

        <!-- 상품 등록 내역 보기 -->
        <div class="content-container2">
          <div class="container-header">
            <img
              src="{{ url_for('static', filename='image/icon/box.svg') }}"
              alt="박스 아이콘"
              class="content-icon"
            />
            <p class="content-font">상품 등록 내역 보기</p>
            <p class="num-font">({{ my_items|length }})</p>

            {% if my_items|length > 4 %}
            <a
              href="{{ url_for('my_products') }}"
              style="
                margin-left: auto;
                font-size: 14px;
                color: #666;
                text-decoration: none;
              "
              >전체보기 ></a
            >
            {% endif %}
          </div>

          <div style="display: flex; flex-direction: column; gap: 12px">
            {% if my_items %}
            <!-- 최대 4개까지만 반복 출력 -->
            {% for item in my_items[:4] %}
            <div
              class="content-box"
              onclick="location.href='{{ url_for('products_detail', name=item.name) }}';"
              style="cursor: pointer"
            >
              <p class="write-head" style="margin-bottom: 8px">
                {{ item.name }}
              </p>
              <div style="display: flex; justify-content: space-between">
                <p class="write-content">{{ item.price }}원</p>
                <p class="write-date">
                  등록일: {{ item.reg_date if item.reg_date else '날짜 정보
                  없음' }}
                </p>
              </div>
            </div>
            {% endfor %} {% else %}
            <p style="padding: 10px; color: #666">등록한 상품이 없습니다.</p>
            {% endif %}
          </div>
        </div>

        <!--상품 리뷰 작성 내역-->
        <div class="content-container2">
          <div class="container-header">
            <img
              src="{{ url_for('static', filename='image/icon/comment.svg') }}"
              alt="댓글 아이콘"
              class="content-icon"
            />
            <p class="content-font">상품 리뷰 작성 내역</p>
            <p class="num-font" id="myReviewCount">(0)</p>
          </div>
          <div style="display: flex; flex-direction: column; gap: 12px">
            <!--기존 실제 연동되게 일단 더미 등록 상품들 삭제-->>
          </div>
        </div>
        <button id="logout-button" class="logout-button">로그아웃</button>
      </div>
    </section>

    <footer><p>@cloud9</p></footer>

    <script>
      document.getElementById("edit-button").addEventListener("click", () => {
        window.location.href = "{{ url_for('mypage_edit') }}";
      });
    </script>
  </body>
</html>
