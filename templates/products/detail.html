<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>상품 상세 - {{ name }}</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/global.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles/products.detail.css') }}"
    />
    <style>
      .like-wrapper {
        display: inline-block;
        position: relative;
        width: 40px;
        height: 40px;
        vertical-align: middle;
        margin-left: 10px;
      }
      .like-toggle { display: none; }
      .like-icon {
        display: inline-block;
        width: 100%;
        height: 100%;
        cursor: pointer;
        background-image: url("{{ url_for('static', filename='image/icon/heart.svg') }}");
        background-size: cover;
      }
      .like-toggle:checked + .like-icon {
        background-image: url("{{ url_for('static', filename='image/icon/heart-fill.svg') }}");
      }
    </style>
  </head>
  <body>
    <header>
      <div class="logo">
        <img
          src="{{ url_for('static', filename='image/Market-logo.png') }}"
          alt="Ewha Market"
        />
      </div>
      <nav>
        <ul class="nav-menu">
          <li><a href="{{ url_for('home') }}" class="active">상품 조회</a></li>
          <li><a href="{{ url_for('reviews_index') }}">리뷰 조회</a></li>
          <li><a href="{{ url_for('reviews_write') }}">리뷰 등록</a></li>
          <li><a href="{{ url_for('products_enroll') }}">상품 등록</a></li>
          {% if session['id'] %}
          <li>
            <a href="{{ url_for('mypage_index') }}"
              ><b>{{ session['id'] }}님 반갑습니다!</b></a
            >
          </li>
          <li>
            <a href="/logout"> 로그아웃 </a>
          </li>
          {% else %}
          <li>
            <a href="{{ url_for('login') }}">회원가입/로그인</a>
          </li>
          {% endif %}
        </ul>
      </nav>
    </header>

    <main>
      <div class="page">
        <div class="detail-card">
          <div class="product-image-area">
            <img
              src="{{ url_for('static', filename='image/products/' + data.img_path) }}"
              alt="{{ name }} 상세 이미지"
            />
          </div>

          <div class="product-info-area">
            <h1 class="product-title">{{ name }}</h1>
            <p class="product-price">₩{{ data.price }}</p>

            <p class="product-delivery-info">
              {{ data.description }}
            </p>

            <ul class="product-details">
              <li><strong>상품 상태</strong> : {{ data.status }}</li>
              <li><strong>지역</strong> : {{ data.addr }}</li>
              <li><strong>판매자ID</strong> : {{ data.seller }}</li>
              <li><strong>카테고리</strong> : {{ data.category }}</li>
              {% if data.phone %}
              <li><strong>연락처</strong> : {{ data.phone }}</li>
              {% endif %}
            </ul>

            <div class="action-buttons">
              <button class="review-btn">리뷰 보기</button>

              <div class="like-wrapper">
                  <input type="checkbox" id="like_detail" class="like-toggle" 
                         {% if is_liked %}checked{% endif %} 
                         onchange="toggleLike('{{ name }}')">
                  <label for="like_detail" class="like-icon"></label>
                  <span id="count_detail" class="like-count-detail">{{ data.like_count }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      <p>@cloud9</p>
    </footer>

    <script>
      function toggleLike(productName) {
          fetch(`/show_heart/${productName}`)
          .then(response => {
              if (response.status === 401) {
                  alert("로그인이 필요합니다.");
                  document.getElementById("like_detail").checked = false;
                  window.location.href = "/login";
                  return null;
              }
              return response.json();
          })
          .then(data => {
              if (data) {
                  console.log("찜 상태 변경:", data.my_heart);
                  document.getElementById("count_detail").innerText = data.like_count;
              }
          })
          .catch(error => console.error('Error:', error));
      }
    </script>

  </body>
</html>